~/.kube/config
~/.aws
cluster/ghcr.io-token.txt

============

everything starts from k8s.mak
grep -r "c756ns"  ./*  #aws756
grep -r "cmpt756" ./*
grep -r "mogami"  ./*
grep -r "vancouver" ./*

============

# eksctl delete cluster --region=us-west-2 --name=aws756
make -f eks.mak start  # start the cluster on aws

# https://scp756-221.github.io/course-site/#/a4/page?embedded=true&hidegitlink=true
# set up the context and namespace
kubectl config use-context aws756
kubectl create ns c756ns
kubectl config set-context aws756 --namespace=c756ns
make -f eks.mak ls
istioctl install -y --set profile=demo --set hub=gcr.io/istio-release
kubectl label namespace c756ns istio-injection=enabled

make -f k8s.mak cri  # https://github.com/mogami95?tab=packages
make -f k8s.mak gw db s1 s2 s3  # start micro services
make -f k8s.mak loader

k9s

# Grafana, Kiali ...
make -f k8s.mak provision
make -f k8s.mak grafana-url
http://xxx.amazonaws.com:3000/login   User:admin,  Password:prom-operator

tools/getip.sh kubectl istio-system svc/istio-ingressgateway  # get cluster ip
Copy CLUSTER_IP to PROJ_ROOT/gatling-x-y.sh  # run gatling scripts on the host machine
# those gatling scripts must be placed under the PROJ_ROOT
tools/kill-gatling.sh  # close all gatling instances

make -f k8s.mak prometheus-url
flask_http_request_total{service="cmpt756s1"}  # cmpt756s2, cmpt756s3, cmpt756db
rate(flask_http_request_total{service="cmpt756db"}[5m])  # last 5 minute

make -f k8s.mak kiali-url
https://scp756-221.github.io/course-site//#/g3-mesh/page?embedded=true&hidegitlink=true

# test via mcli client
kubectl get svc --all-namespaces | cut -c -150
export EXTERNAL_IP="xxx.amazonaws.com"
cd mcli
make build-mcli
make S2_SERVER=$EXTERNAL_IP S3_SERVER=$EXTERNAL_IP S2_PORT=80 S3_PORT=80 run-mcli
read 6ecfafd0-8a35-4af6-a9e2-cbd79b3abeea
readplaylist 49206bf0-ad4e-11ec-b909-0242ac120002

# do some changes if any
make -f k8s.mak cri
make -f k8s.mak rollout-s  # restart the corresponding service

# commit the changes and stop the cluster
make -f eks.mak stop  # ATTENTION
